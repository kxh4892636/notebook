---
id: 5b6fa40c-5ead-4e08-afa2-5a9ae77f55a1
---
# 网络请求和远程资源

## SSE

### 基础

**SSE**

- 服务器推送;
- 单向通道;

### 数据格式

**字符编码**

- UTF-8;

**message**

```bash
# 一次信息有若干 message 组成
# 使用 : 表示注释
# message 之间 \n\n 间隔
# 单个 message 使用 \n 跨行
: this is a test stream\n\n

data: some text\n\n

data: another message\n
data: with two lines \n\n
```

**字段**

```bash
# data 表示数据内容
data: begin message\n
data: continue message\n\n

# id 字段表示标识符, 用于重连机制
id: msg1\n
data: message\n\n

# event 字段表示自定义事件, 默认为 message
event: foo\n
data: a foo event\n\n

event: bar\n
data: a bar event\n\n

data: an unnamed event\n\n

# retry 字段指定浏览器重连时间间隔
retry: 10000\n
```

### 客户端

```typescript
// 建立 EventSource 对象
const source = new EventSource(url); // 只能是 get 请求
// 链接建立, 触发 open 事件
source.addEventListener(
  "open",
  (event) => {
    //...
  },
  false
);
// 服务器返回信息, 触发 message 事件
source.addEventListener(
  "message",
  (event) => {
    const data = event.data;
    // ...
  },
  false
);
// 链接出错, 触发 error 事件
source.addEventListener(
  "error",
  (event) => {
    // ...
  },
  false
);
// 关闭 EventSource 对象
source.close();
```

### 服务端

```typescript
// 设置 http 头
res.setHeader("Content-Type", "text/event-stream");
res.setHeader("Cache-Control", "no-cache");
// 发送数据
res.write(
  `data:  ${JSON.stringify({ status: "success", content: [datasetID, modelID, [uvID]] })}\n\n`
);
```
